<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="yes" name="apple-touch-fullscreen"><meta content="telephone=no,email=no" name="format-detection"><meta name="Cache-Type" content="image/gif,image/png,image/jpg"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>个人信息</title><meta name="description" content=""><meta name="keywords" content="index"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-title" content=""><script src="../js/flexible.js"></script><script src="../js/flexible_css.js"></script><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../css/user.css"></head><body><div class="navbar"><div class="back_arrow back_home" id="back"></div><h1>个人信息</h1></div><div class="mainContent" id="main"><div id="userinfo-box"><div class="userinfo-item arrow-right" id="myphoto"><div class="userinfo-wrapper"><h2>我的头像</h2><form id="formFile" name="formFile" enctype="multipart/form-data"><img src="" class="toux-img" id="userImg"> <input type="file" class="image-file" id="fileToUpLoad" name="fileToUpLoad"></form></div></div><div class="userinfo-item" id="nickname"><div class="userinfo-wrapper"><h2>我的昵称</h2><p id="userName"></p></div></div><div class="userinfo-item arrow-right" id="identity"><div class="userinfo-wrapper"><h2>身份信息</h2><p id="iscertificate" class="red"></p></div></div><div class="userinfo-item" id="tel"><div class="userinfo-wrapper"><h2>手机号码</h2><p id="userTel"></p></div></div><div class="userinfo-item arrow-right" id="password"><div class="userinfo-wrapper"><h2>密码管理</h2><p id="isSetPwd" class="red"></p></div></div><div class="userinfo-item arrow-right" id="bankcard"><div class="userinfo-wrapper"><h2>银行卡管理</h2><p id="isSetBankCard" class="red"></p></div></div></div></div><script src="../js/zepto.min.js"></script><script src="../js/main.js?v=0.01"></script><script src="../js/Exif.js"></script><script>var base64Image=function(t){var e=t.file,n=t.width?t.width:750,a=t.ratio?t.ratio:.7,r=t.callback?t.callback:null;if(window.FileReader){var i=e,o=new FileReader,l=null;EXIF.getData(i,function(){l=EXIF.getTag(this,"Orientation"),o.readAsDataURL(i)}),o.onloadstart=function(){},o.onerror=function(){},o.onload=function(){e.value="";var o=new Image;o.src=this.result,o.onload=function(){var t=document.createElement("canvas"),e=o.width/o.height;6==l?(t.width=o.height<n?o.height:n,t.height=parseInt(t.width*e),t.getContext("2d").rotate(90*Math.PI/180),t.getContext("2d").drawImage(o,0,0,o.width,o.height,0,-t.width,t.height,t.width)):8==l?(t.width=o.height<n?o.height:n,t.height=parseInt(t.width*e),t.getContext("2d").rotate(-90*Math.PI/180),t.getContext("2d").drawImage(o,0,0,o.width,o.height,-t.height,0,t.height,t.width)):(3==l?(t.width=o.width<n?o.width:n,t.height=parseInt(t.width/e),t.getContext("2d").translate(t.width,0),t.getContext("2d").scale(-1,1),t.getContext("2d").translate(0,t.height),t.getContext("2d").scale(1,-1)):(t.width=o.width<n?o.width:n,t.height=parseInt(t.width/e)),t.getContext("2d").drawImage(o,0,0,o.width,o.height,0,0,t.width,t.height));var i=t.toDataURL("image/jpeg",a);r&&r(i)}}}else alert("请升级浏览器")};function convertBase64UrlToBlob(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],o=atob(e[1]),n=o.length,a=new Uint8Array(n);n--;)a[n]=o.charCodeAt(n);return new Blob([a],{type:i})}T.userInfo=function(){var l=[],e={init:function(){var t=T.Storage.get("userinfo");T.Util.isEmpty(T.Storage.get("userinfo"))?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/login.html"):(t.userPic&&$("#userImg").attr("src",t.userPic),t.nickName&&$("#userName").html(t.nickName),t.userMobile&&$("#userTel").html(t.userMobile),t.realName&&t.idCard?$("#iscertificate").text("已认证"):$("#iscertificate").text("未认证"),"1"==t.isSetPwd?$("#isSetPwd").text(""):$("#isSetPwd").text("未设置"),e.getBankCardList(),e.bindEvent())},getBankCardList:function(){T.Util.xmlHttpRequest({type:"get",reqUrl:"/user/services/user/bankCardList.json",callback:function(t){var e=t.res_data.value.INFO;e.length?$("#isSetBankCard").text(""):$("#isSetBankCard").text("未设置"),T.Storage.set("bankCardList",e)},errorCallback:function(){}})},bindEvent:function(){var r,e=T.Storage.get("userinfo");$("#fileToUpLoad").off().change(function(){l=[];var t=$(this),e=t[0],i=window.URL||window.webkitURL,o=$("#userImg");if(e&&e.files&&e.files[0]){var n=e.files[0];if(console.log("压缩前："+n.size/1024+"kb"),200<n.size/1024){base64Image({width:750,ratio:.75,file:n,callback:function(t){r=convertBase64UrlToBlob(t),console.log("压缩后："+r.size/1024+"kb"),o.attr("src",t),l.push(r),a()}})}else r=i.createObjectURL(n),o.attr("src",r),l.push(n),a()}else r=t.val();function a(){for(var t,e=new FormData,i=0;t=l[i];i++)e.append("files",t,(new Date).getTime()+t.type.replace("image/","."));$.ajax({url:Global.fullHost+"/user/services/servlet/resource?signKey=f95fd9e45de9463186f0984f9b5e0962&type=1",type:"POST",data:e,async:!1,cache:!1,contentType:!1,processData:!1,headers:{Authenticate:T.Storage.get("access_token")},success:function(t){"0"==t.msg_code?tip("上传成功","ok"):tip(t.msg,"error")},error:function(t){tip(t.msg||Global.neterror,"error")}})}}),$("#nickname").off().Touch(function(t){(T.Util.isEmpty(e.nickName)||"0"==e.isUpdateName)&&T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/editNickName.html")}),$("#identity").off().Touch(function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/identityInfo.html")}),$("#tel").off().Touch(function(){e.userMobile?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/changeMobile.html"):T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/setMobile.html")}),$("#password").off().Touch(function(){var t=T.Storage.get("userinfo");t&&t.userMobile?"1"==t.isSetPwd?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/changePwd.html"):T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/setPwd.html"):confirm({html:"请先绑定手机号码，再设置登录密码",cancelText:"取消",okText:"确定",okFun:function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/setMobile.html")}})}),$("#bankcard").off().Touch(function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/myBankCard.html")})}};return{init:e.init}}(),$(document).ready(function(){T.isNative?T.appToH5.init(function(){T.userInfo.init()},function(){T.Util.isEmpty(T.Storage.get("userinfo"))?T.Util.back():T.userInfo.init()},function(){},function(){},function(){}):T.userInfo.init()})</script></body></html>