<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="yes" name="apple-touch-fullscreen"><meta content="telephone=no,email=no" name="format-detection"><meta name="Cache-Type" content="image/gif,image/png,image/jpg"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>新建收货地址</title><meta name="description" content=""><meta name="keywords" content="index"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-title" content=""><script src="../js/flexible.js"></script><script src="../js/flexible_css.js"></script><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../css/user.css"><link rel="stylesheet" href="../css/iosSelect.css"><style>#setUserMobile{height:1rem;text-align:center;line-height:1rem;font-size:.4rem;background:#f6d768;color:#666;display:none}</style></head><body><div class="navbar absolute"><div class="back_arrow back_home" id="back"></div><h1 id="navtitle">新建收货地址</h1></div><div class="mainContent" id="main"><div id="setUserMobile">为了更好为你服务，请完善您的账户信息</div><div id="editaddress-box"><div class="editaddress-item"><h2>收货人</h2><input type="text" id="name" placeholder="请输入收货人" maxlength="15"><i class="clear"></i></div><div class="editaddress-item"><h2>手机号码</h2><input type="tel" id="tel" placeholder="请输入手机号码" maxlength="11"><i class="clear"></i></div><div class="editaddress-item arrow-right" id="area"><h2>省,市,区</h2><p class="area"></p></div><div class="editaddress-item address"><textarea placeholder="请填写详细地址，不少于2个字" id="address" maxlength="50"></textarea></div><div id="editaddress-submit">保存</div></div></div><script src="../js/zepto.min.js"></script><script src="../js/main.js"></script><script src="../js/areaData_v2.js"></script><script src="../js/iosSelect.js"></script><script src="//pv.sohu.com/cityjson?ie=utf-8"></script><script>T.editAddress=function(){var n=!0,d=T.Util.getPara("orderNo"),l=function(t){if(""==t)tip("请输入收货人姓名！");else{if(!(t.length<2))return!0;tip("姓名请输入2~15个字符！")}},c=function(t){var e=T.Storage.get("userinfo");if(""==t)tip("请输入11位手机号码！");else{if(e&&t==e.userMobile)return!0;if(/^1\d{10}$/.test(t))return!0;tip("请输入11位手机号码！")}},u=function(t){if(""==t)tip("请选择地区！");else if(T.Util.isEmpty($("#area .area").attr("data-city-code")))tip("请选择市县（区）");else{if(!T.Util.isEmpty($("#area .area").attr("data-district-code")))return!0;tip("请选择县（区）")}},f=function(t){if(""==t)tip("请输入详细地址！");else{if(!(t.length<2))return!0;tip("请输入2~50个字符！")}},v={init:function(){var t=T.Storage.get("userinfo");T.Util.isEmpty(t)||!T.Util.isEmpty(t.userMobile)||T.Util.isEmpty(d)?$("#setUserMobile").hide():($("#setUserMobile").show(),$("#setUserMobile").off().Touch(function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/user/setMobile.html")}));var e=T.Util.getPara("id"),i=T.Storage.get("editAddressInfo");if(e&&i)$("#navtitle").text("编辑收货地址"),$("#name").val(i.userName),$("#address").val(i.userAddr),$("#tel").val(i.userPhone),console.log(i),"null"!=i.areaCode.split("#")[0]&&($(".area").html(i.area),$(".area").attr("data-province-code",i.areaCode.split("#")[0]),$(".area").attr("data-city-code",i.areaCode.split("#")[1]),$(".area").attr("data-district-code",i.areaCode.split("#")[2])),T.Storage.remove("editAddressInfo");else{$("#navtitle").text("新建收货地址");var a=T.Storage.get("userinfo");a&&a.realName&&$("#name").val(a.realName),a&&a.userMobile&&$("#tel").val(a.userMobile);try{if(returnCitySN){var r=T.Util.trim(returnCitySN.cname),o="",s="",n="";/省/.test(r)?o=r.slice(0,r.indexOf("省")+1):/自治区/.test(r)?o=r.slice(0,r.indexOf("自治区")+3):(/北京/.test(r)||/天津/.test(r)||/上海/.test(r)||/重庆/.test(r))&&(o=r.slice(0,3)),o&&(/北京/.test(r)||/天津/.test(r)||/上海/.test(r)||/重庆/.test(r)?s=r.slice(3,6):/市/.test(r)&&(s=r.slice(o.length,r.indexOf("市")+1))),o&&s&&(n=r.slice(o.length+s.length,r.length)),$("#area .area").text(o+" "+s+" "+n),o&&iosProvinces&&$("#area .area").attr("data-province-code",v.getCityCode(o,iosProvinces)),s&&iosCitys&&$("#area .area").attr("data-city-code",v.getCityCode(s,iosCitys)),n&&iosCountys&&$("#area .area").attr("data-district-code",v.getCityCode(n,iosCountys))}}catch(t){console.log("获取定位失败")}}v.bindEvent()},bindEvent:function(){$("#area").off().Touch(function(t){$("input,textarea").blur();var a=$(".area"),e=a.attr("data-province-code"),i=a.attr("data-city-code"),r=a.attr("data-district-code");new IosSelect(3,[iosProvinces,iosCitys,iosCountys],{title:"地址选择",itemHeight:.93333333,cssUnit:"rem",relation:[1,1],headerHeight:1,oneLevelId:e,twoLevelId:i,threeLevelId:r,callback:function(t,e,i){a.attr("data-province-code",t.id),a.attr("data-city-code",e.id),a.attr("data-district-code",i.id),a.html(t.value+" "+e.value+" "+i.value)}})}),$("#editaddress-submit").off().Touch(function(){var t=T.Storage.get("userinfo"),i=$("#name").val().trim(),a=$("#tel").val().trim(),r=$(".area").html().trim(),o=$(".area").attr("data-province-code")+"#"+$(".area").attr("data-city-code")+"#"+$(".area").attr("data-district-code"),s=$("#address").val().trim();if(l(i)&&c(a)&&u(r)&&f(s)){var e={data:{userName:i,userPhone:a,area:r,areacode:o,userAddr:s,isDefault:t&&t.userMobile==a?"1":"0"}};if(T.Util.isEmpty(T.Util.getPara("id"))||(e.data.addrId=T.Util.getPara("id")),!n)return!1;n=!1,T.Util.xmlHttpRequest({type:"post",reqData:e,reqUrl:"/user/services/user/userAddress.json",callback:function(t){if("select"==T.Util.getPara("type")){var e={ADDR_ID:t.res_data.value,AREA:r,AREA_CODE:o,USER_ADDR:s,USER_NAME:i,USER_PHONE:a};T.Storage.set("selectAddressInfo",e)}tip("保存成功","ok"),T.Util.isEmpty(d)?setTimeout(function(){n=!0,"buy"==T.Util.getParaSearch("from")?T.Util.back({num:2}):T.Util.back()},1500):T.Util.xmlHttpRequest({type:"get",errorType:1,reqUrl:"/order/services/order/addOrderInfo.json?orderNo="+d+"&addId="+t.res_data.value,callback:function(t){T.Storage.set("orderAddAddressOK",d),T.Util.back()},errorCallback:function(){}})},errorCallback:function(){n=!0}})}}),$("input").on("input",function(){0<$(this).val().length?$(this).parent().addClass("writing"):$(this).parent().removeClass("writing")}),$("input").on("blur",function(){$(this).parent().removeClass("writing")}),$(".clear").off().Touch(function(){$(this).parent().find("input").val(""),$(this).parent().removeClass("writing")})},getCityCode:function(t,e){for(var i=0;i<e.length;i++)if(e[i].value==t)return e[i].id}};return{init:v.init}}(),$(document).ready(function(){T.isNative?T.appToH5.init(function(){T.editAddress.init()},function(){T.editAddress.init()},function(){},function(){},function(){}):T.editAddress.init()})</script></body></html>