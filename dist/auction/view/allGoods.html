<style>body,html{background-color:#fff!important}#goodsmenu{position:fixed;left:calc(50% - 5rem);top:1.7066667rem;width:2.4rem;overflow-y:auto;-webkit-overflow-scrolling:touch}#goodsmenu .goodsmenu-item{position:relative;width:100%;height:1.6rem;text-align:center;line-height:1.6rem;font-size:.37rem;color:#333;background-color:#f7f7f7;border-bottom:2px solid #fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#goodsmenu .goodsmenu-item.on{background-color:#fff;color:#f72f2f}#goodsmenu .goodsmenu-item.on:before{content:'';position:absolute;left:0;top:0;display:inline-block;width:.0533334rem;height:100%;background-color:#f72f2f}#goodscontent{margin-left:2.4rem;background-color:#fff;overflow-y:auto;-webkit-overflow-scrolling:touch}.goods-item{position:relative;margin-left:.4rem;width:calc(100% - .4rem);height:3.05rem;border-bottom:1px solid #dfdfdf}.goods-item.over img{opacity:.6}.goods-item.over:after{content:'';position:absolute;left:-.226667rem;top:.96rem;display:inline-block;background:url(../img/sprite.png) no-repeat 0 -7.6rem;background-size:13.226667rem 11.946667rem;width:1.973333rem;height:1.066667rem}.goods-item.pre h2.goodsdesc{margin-top:.52rem}.goods-item.pre p.preline{float:left;clear:both;margin-top:.08rem;padding-left:1.8rem;line-height:.56rem;font-size:.32rem;color:#999}.goods-item.pre p.prenow{float:left;clear:both;padding-left:1.8rem;line-height:.56rem;font-size:.373333rem;color:#333}.goods-item:last-child{border-bottom:none}.goods-item img{position:absolute;left:0;top:.75rem;width:1.55rem;height:1.55rem}.goods-item h2.goodsdesc{float:left;overflow:hidden;margin-top:.27rem;padding-left:1.8rem;width:calc(100% - 3.96rem);max-height:.86rem;line-height:.43rem;word-break:break-all;font-size:.35rem;color:#333}.goods-item p.endtime{float:left;margin-top:.13rem;padding-left:1.8rem;width:calc(100% - 3.96rem);line-height:.43rem;font-size:.37rem;color:#f72f2f}.goods-item p.currentprice{float:left;margin-top:.1rem;padding-left:1.76rem;width:calc(100% - 3.96rem);line-height:.43rem;font-size:.43rem;color:#f72f2f}.goods-item p.leaduser{float:left;margin-top:.08rem;padding-left:1.8rem;width:calc(100% - 3.96rem);line-height:.43rem;font-size:.32rem;color:#999}.goods-item .goods-submit{position:absolute;right:0;top:0;width:2rem;height:100%}.goods-item .goods-submit:before{content:'';position:absolute;left:0;top:.59rem;display:inline-block;width:1px;height:1.87rem;background-color:#dfdfdf}.goods-submit em{position:absolute;right:.27rem;top:1.15rem;display:inline-block;width:1.47rem;height:.75rem;text-align:center;line-height:.75rem;font-size:.4rem;color:#fff;border-radius:.37rem;background-color:#f72f2f}.goods-submit em.pre{background-color:#ffa800;color:#fff}.goods-submit em.stop{background-color:#eee;color:#999}.goods-submit em.over{background-color:#eee;color:#999}.pre .otherBox,.pre em.auction,.pre em.over,.pre em.stop{display:none}.pre .preBox,.pre em.pre{display:block}.over .preBox,.over em.auction,.over em.pre,.over em.stop{display:none}.over .otherBox,.over em.over{display:block}.stop .preBox,.stop em.auction,.stop em.over,.stop em.pre{display:none}.stop .otherBox,.stop em.stop{display:block}.auction .preBox,.auction em.over,.auction em.pre,.auction em.stop{display:none}.auction .otherBox,.auction em.auction{display:block}#search-box{background-color:#fff;overflow:hidden}#search-box .search-count{height:.8rem;line-height:.8rem;padding-left:.45rem;font-size:.32rem;color:#666;background-color:#f5f5f5}#search-box .goods-item{margin:0 .45rem;width:calc(100% - .9rem)}#search-box input::-webkit-input-placeholder{line-height:.3466667rem;font-size:.32rem}#search-box input:-moz-placeholder{line-height:.3466667rem;font-size:.32rem}#search-box input::-moz-placeholder{line-height:.3466667rem;font-size:.32rem}#search-box input:-ms-input-placeholder{line-height:.3466667rem;font-size:.32rem}#search-box #search-content{overflow-y:auto;-webkit-overflow-scrolling:touch}#search-history{overflow:hidden;position:relative}#search-history h2{margin-top:.2rem;height:.973333rem;padding:0 .453333rem;line-height:.973333rem;font-size:.32rem;color:#999}#search-history #clear_search{position:absolute;top:.4733333rem;right:.4533333rem;display:inline-block;width:1.066667rem;height:1.066667rem;background:url(../img/sprite.png) no-repeat -7.6rem -11.146667rem;background-size:13.226667rem 11.946667rem;width:.426667rem;height:.426667rem}#search-history #history-list{margin-left:.453333rem;margin-right:.213333rem}#search-history #history-list em{float:left;margin-right:.24rem;margin-bottom:.24rem;height:.853333rem;padding:0 .373333rem;line-height:.853333rem;background-color:#f4f4f4;border-radius:.053333rem;font-size:.373333rem;color:#666}#stopAuctionBox{position:fixed;width:100%;height:10.5rem;z-index:102;top:3.5rem;display:none;max-width:10rem;text-align:center}.stopAuctionBg{background:url(../img/goods/stopAuction.png) no-repeat;background-size:10rem 10rem;margin:auto;width:10rem;height:100%;position:relative}.stopAuctionBg .content{font-size:.373333rem;color:#ff4021;margin-top:4.5rem;width:7rem;left:1.5rem;position:absolute;margin-top:4.4rem}.stopAuctionBg .btn{position:absolute;bottom:2.4rem;width:6.2rem;left:1.9rem;height:1.2rem}</style><div class="content" id="content"><div id="allGoods-box"><div id="goodsmenu"><div id="goodsmenu-wrapper"></div></div><div id="goodscontent"><div id="goodscontent-wrapper"></div></div></div><div id="search-box" style="display:none"><div id="search-history"><h2>最近搜索</h2><i id="clear_search"></i><div id="history-list"><div class="nodata"><h2>暂无搜索历史</h2></div></div></div><div id="search-content" style="display:none"><div id="search-wrapper"><h2 class="search-count">搜索结果...</h2></div></div></div><div class="clearboth"></div></div><div id="stopAuctionBox"><div class="stopAuctionBg"><div class="content"></div><div class="btn"></div></div></div><div class="mask hide"></div><script>T.allGoods=function(){T.Util.getParaHash("page");var r="",n=1,c=!1,e="",s=1,i=!1,a=!0,l=!0,t=T.Util.getAppInfo("deviceID"),d={init:function(){d.loadCache(),d.initPage(),d.getSearchHistory(),d.getProductColumnList(),d.bindEvent()},initPage:function(){$(".pageType p[data-href]").eq(2).addClass("on").siblings().removeClass("on"),$("#goodsmenu,#goodscontent,#search-content").height(window.innerHeight-$(".navbar").height()-(T.isNative?0:$("footer").height())),T.isNative||$(".clearboth").addClass("h5")},loadCache:function(){var t=T.Storage.get("allGoods");t&&($("#content").html(t),$("#allGoods-box").show(),$("#search-box").hide())},bindEvent:function(){$("#goodscontent").off().scroll(d.loadMoreData),$("#goodscontent").dropload({loadUpFn:function(t){r=t,n=1,T.Util.isEmpty($(".goodsmenu-item.on").attr("data-id"))?d.getProductColumnList():d.getProductList($(".goodsmenu-item.on").attr("data-id"))},scrollArea:$("#goodscontent"),threshold:50}),$("#search-content").off().scroll(function(){var t=$(this).scrollTop()+5;$(this).children().eq(0).height()<=t+$(this).height()&&a&&i&&d.doSearch(e,!0)}),$("#searchinput").on("focus",function(){d.searchRecover(),$("#searchbox").addClass("search"),$("#search-box").show().siblings().hide()}),$("#searchinput").on("blur",function(){}),$("#searchinput").on("input",function(){$("html,body").removeClass("white"),$("#search-content").show().siblings().hide();var t=T.Util.trim($("#searchinput").val());t?$("#search-content").html('<h2 class="search-count">搜索"'+$(this).val()+'"</div>'):d.searchRecover(),!T.isNative&&t&&l&&(clearTimeout(T.searchTimeout),T.searchTimeout=setTimeout(function(){d.doSearch(t)},1e3))}),$("#search_cancel").off().Touch(function(){$("#searchinput").blur(),$("#searchbox").removeClass("search"),$("#search-box").hide().siblings().show(),d.searchRecover()})},bindGoodsEvent:function(){$(".goodsmenu-item").off().Touch(function(t){(t=$(t)).hasClass("on")||(n=1,t.addClass("on").siblings().removeClass("on"),d.getProductList(t.attr("data-id")))}),$(".goods-item").off().Touch(function(e){if($(e).hasClass("pre")){if(1==$(e).attr("data-isvisitor"))return void tip("您已预约哦");var o=$(e).attr("data-id"),a=$(e).find(".preBox .prenow span"),s=1*a.html();T.Util.xmlHttpRequest({type:"get",reqUrl:"/commodity/services/product/visitors.json?expectNo="+$(e).attr("data-no")+"&commodityId="+o,callback:function(t){$(e).attr("data-isvisitor",1),$(e).find(".pre").html("已预约"),tip("预约成功！","ok"),a.html(s+1),s+1>=$(e).find(".preBox .preline span").html()&&setTimeout(function(){$(e).hasClass("pre")&&T.Util.getCommodityInfo(o)},500)},errorCallback:function(t){"1001"==t.msg_code&&"当前商品暂时不能预约"==t.msg||"已预约"==t.msg?setTimeout(function(){$(e).hasClass("pre")&&T.Util.getCommodityInfo(o)},500):t&&tip(t.msg,"error")}})}else $(e).hasClass("auction")?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/view/go.html#page=goodsDetail.html&id="+$(e).attr("data-id")+"&expectNo="+$(e).attr("data-no")+"&isNext=1"):$(e).hasClass("stop")&&T.Util.xmlHttpRequest({type:"get",errorType:1,reqUrl:"/commodity/services/template/GET_EXPECT_INFO.json?commodityId="+$(e).attr("data-id"),callback:function(t){var e=t.res_data[0];if(!T.Util.isEmpty(e)&&(120==e.expectStatus&&tip("当前商品已暂停竞拍"),e.IS_STOP_TIME&&"1"==e.IS_STOP_TIME&&200==e.expectStatus)){var o=e.DAY_START_SALES,a=e.DAY_STOP_SALES;$("#stopAuctionBox .content").html("为了您的身心健康，平台<br>从"+o+"<br>至"+a+"<br>暂停竞拍,请合理安排竞拍时间，谢谢！"),$("#stopAuctionBox,.mask").show(),$("#stopAuctionBox .btn").off().Touch(function(){$("#stopAuctionBox,.mask").hide()})}},errorCallback:function(t){console.log(t)}})})},bindSearchEvent:function(){$("#history-list em").off().Touch(function(){var t=$(this).text();$("#searchinput").val(t),$("#search-content").show().siblings().hide(),setTimeout(function(){d.doSearch(t)},500)}),$("#clear_search").off().Touch(function(){confirm({html:"确定清空历史搜索吗？",cancelText:"取消",okText:"确定",okFun:function(){d.clearSearchHistory()}})})},loadMoreData:function(){var t=$(this).scrollTop()+5;$(this).children().eq(0).height()<=t+$(this).height()&&a&&c&&d.getProductList($(".goodsmenu-item.on").attr("data-id"),!0)},strLimit:function(t){return t?32<=T.Util.getStrLen(t)?T.Util.strSlice(t,32)+"...":t:""},getProductColumnList:function(){tip("加载中...","loading"),T.Util.xmlHttpRequest({type:"get",reqUrl:"/commodity/services/product/productColumnList.json",callback:function(t){pageLoading.hide(),""!=r&&(r.resetload(),r.unlock(),r.noData(!1),r="");var e=[],o=t.res_data?t.res_data.value.COL_LIST:[];e.push('<div class="goodsmenu-item on" data-id="all">全部</div>');for(var a=0,s=o.length;a<s;a++)e.push('<div class="goodsmenu-item" data-id="'+o[a].COLUMN_ID+'">'+o[a].COLUMN_NAME+"</div>");var i=t.res_data.value.INFO_LIST;i.INFO&&d.showProductListHtml(i.INFO),"2"==i.ISEND?(n++,c=!0):c=!1,e.length&&($("#goodsmenu-wrapper").html(e.join("")),setTimeout(function(){/allGoods.html/.test(window.location.href)&&T.Storage.set("allGoods",$("#content").html().replace(/\ssrc="http.+?"/gi,' src="../img/goods/lazy_load.png" data-loaded="true" '))},10)),d.bindGoodsEvent()},errorCallback:function(t,e,o){""!=r&&(r.resetload(),r.unlock(),r.noData(!1),r=""),pageLoading.hide(),"timeout"!=o&&"abort"!=o&&"error"!=o||$(".goods-item").length||($("#allGoods-box").html('<div class="nonet"><i></i><h2>您的网络不稳定，请刷新重试~</h2><div id="page-refresh" class="btn">刷新</div></div>'),$("#page-refresh").off().Touch(function(){window.location.reload()}))}})},getProductList:function(t,o){tip("加载中...","loading");var e="/commodity/services/product/productList.json?page="+n+"&limit=10";"all"!=t&&(e=e+"&columnId="+t),a=!1,T.Util.xmlHttpRequest({type:"get",reqUrl:e,callback:function(t){pageLoading.hide();var e=t.res_data&&t.res_data.value?t.res_data.value.INFO:[];2==t.res_data.value.ISEND?(c=!0,n++):c=!1,d.showProductListHtml(e,o)},errorCallback:function(){pageLoading.hide(),a=!0,""!=r&&(r.resetload(),r.unlock(),r.noData(!1),r=""),setTimeout(function(){tip(data?data.msg:Global.neterror,"error")},500)}})},doProductListHtml:function(t){for(var e=[],o=[],a=0;a<t.length;a++){var s="",i="<cite>--</cite>:<cite>--</cite>:<cite>--</cite>";80==t[a].EXPECT_STATUS?s="pre":100==t[a].EXPECT_STATUS?(s="auction",addTimer("#"+t[a].COMMODITY_ID,Math.ceil(t[a].SURPLUS_TIME/1e3)),console.log("")):120==t[a].EXPECT_STATUS||90==t[a].EXPECT_STATUS?(s="stop",i=90==t[a].EXPECT_STATUS?"暂停预约":"暂停竞拍"):s="over",o.push("auction/commodity/"+t[a].COMMODITY_ID),e.push('<div class="goods-item '+s+'" data-id="'+t[a].COMMODITY_ID+'" data-no="'+t[a].EXPECT_NO+'" data-expect_id="'+t[a].EXPECT_ID+'" data-isVisitor="'+t[a].IS_VISITOR+'">                                        <img class="goodsimg lozad" src="../img/goods/lazy_load.png" data-src="'+(t[a].COMMODITY_LOGO||"../img/nodata/nopic120.png")+'" onerror="T.Util.showDefaultPic(this)">                                        <h2 class="goodsdesc">'+d.strLimit(t[a].COMMODITY_TITLE)+'</h2>                                        <div class="preBox"><p class="preline">满<span>'+t[a].BESPEAK_MIN_NUM+'</span>人开拍</p>                                        <p class="prenow">已预约<span>'+t[a].BESPEAK_NUM+'</span>人</p></div>                                        <div class="otherBox"><p class="endtime" id="'+t[a].COMMODITY_ID+'" data-djs="'+t[a].COUNT_DOWN+'" type-djs="1">'+i+'</p>                                        <p class="currentprice">￥<em class="AUCTION_PRICE">'+(t[a].AUCTION_PRICE?(1*t[a].AUCTION_PRICE).toFixed(2):"0.00")+'</em></p>                                        <p class="leaduser"><span class="shopUserName">'+(t[a].AUCTION_USER_NAME||"暂时无人出价")+"</span></p></div>"),e.push('<div class="goods-submit" data-isVisitor="'+t[a].IS_VISITOR+'"><em class="pre">'+(t[a].IS_VISITOR?"已预约":"预约")+'</em><em class="auction">竞拍</em><em class="stop">暂停</em><em class="over">已成交</em></div> </div>')}return setTimeout(function(){T.Util.mqtt(o)},100),e},showProductListHtml:function(t,e){var o=d.doProductListHtml(t);""!=r&&($("#goodscontent-wrapper").html(""),r.resetload(),r.unlock(),r.noData(!1),r=""),o.length?e?$("#goodscontent-wrapper").append(o.join(" ")):($("#goodscontent").scrollTop(0),$("#goodscontent-wrapper").html(o.join(" "))):e||$("#goodscontent-wrapper").html('<li class="nodata goods"><i></i><h2>暂无类别数据哦~</h2></li>'),a=!0,lozad().observe(),d.bindGoodsEvent()},getSearchHistory:function(){T.Util.xmlHttpRequest({type:"get",reqUrl:"/commodity/services/product/productSearchLog?deviceCd="+t,callback:function(t){t&&(t.res_data||(t.res_data={}),d.showSearchHistory(t.res_data.value||[]))},errorCallback:function(){}})},showSearchHistory:function(t){var o=[];$.each(t,function(t,e){o.push("<em>"+e.SEARCH_INFO+"</em>")}),o.length?($("#clear_search").show(),$("#history-list").html(o.join(""))):($("#clear_search").hide(),$("#history-list").html('<div class="nodata"><h2>暂无搜索历史</h2></div>')),d.bindSearchEvent()},clearSearchHistory:function(){T.Util.xmlHttpRequest({type:"get",reqUrl:"/commodity/services/product/invalidSearchLog?deviceCd="+t,callback:function(t){$("#clear_search").hide(),$("#history-list").html('<div class="nodata"><h2>暂无搜索历史</h2></div>')},errorCallback:function(){}})},doSearch:function(o,a){if(!l)return!1;l=!1,e=o,T.Util.xmlHttpRequest({type:"get",reqUrl:"/commodity/services/product/productELSearch?deviceCd="+t+"&query="+o+"&page="+s+"&limit=10",callback:function(t){if(l=!0,"0"==t.msg_code){if(t.res_data.value){"2"==t.res_data.value.ISEND?(s++,i=!0):i=!1;var e=t.res_data.value;d.showSearch(e,o,a)}}else t.msg&&tip(t.msg)},errorCallback:function(){l=!0}})},showSearch:function(t,e,o){var a=t.INFO,s=t.totalNum;if($("#searchinput").val("").blur().attr("placeholder",""),$("#searchbox").addClass("success").prepend("<em>"+e+"</em>"),$("#searchbox em").off().Touch(function(){d.searchRecover()}),a.length){var i=[];o||i.push('<h2 class="search-count">搜索结果 '+e+"("+s+")</h2>"),i=i.concat(d.doProductListHtml(a)),$("html,body").removeClass("white"),o?$("#search-content").append(i.join(" ")):$("#search-content").html(i.join(" ")),lozad().observe(),d.bindGoodsEvent()}else $("html,body").addClass("white"),$("#search-content").html('<div class="nodata search"><i></i><h2>未搜索到此商品，请尝试其它关键字搜索</h2></div>');d.getSearchHistory()},searchRecover:function(){i=!(s=1),$("html,body").addClass("white"),$("#searchbox").removeClass("success").find("em").remove(),$("#searchinput").attr("placeholder","搜索您需要的商品"),$("#search-history").show().siblings().hide(),$("#search-content").html("")}};return{init:d.init,doSearch:d.doSearch}}(),$(document).ready(function(){T.allGoods.init()})</script>