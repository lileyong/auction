<link rel="stylesheet" href="../css/auctionTrend.css"><style>#auctionGoods{float:none;position:relative;width:100%;height:2.666667rem;border:none;background-color:#fff;overflow:hidden}#auctionGoods #goodsImg{position:absolute;left:.453333rem;top:.373333rem;width:1.92rem;height:1.92rem}#auctionGoods #goodsDesc{padding:.4rem .613333rem 0 2.56rem;height:.96rem;text-align:left;line-height:.48rem;font-size:.346667rem;color:#666;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}#auctionGoods #goodsPrice,#goodsState{height:1.306667rem;padding-left:2.56rem;text-align:left;line-height:1.306667rem;font-size:.4rem;color:#333}#auctionGoods #goodsPrice span{text-align:left;font-size:.32rem;color:#333;letter-spacing:0;border:none}#auctionGoods #goodsPrice span em{font-size:.32rem;color:#333;letter-spacing:0}#auctionGoods #goodsPrice span em:last-child{font-size:.4rem}#auctionGoods #goodsPrice del{margin-left:.4rem;font-size:.32rem;color:#999;letter-spacing:0}#auctionData{margin-top:.266667rem;width:100%;height:6.426667rem;background-color:#fff;overflow:hidden}#auctionData #trendData{width:100%;height:5.066667rem;background:url(../img/goods/trenddata_bg.png) center center/9.12rem 4.293333rem no-repeat;overflow:hidden}#auctionData #trendData .trendDataItem{float:left;width:50%;height:2.533333rem}#auctionData #trendData .trendDataItem h2{margin-top:.333333rem;padding-left:1.04rem;line-height:.533333rem;font-size:.373333rem;color:#999}#auctionData #trendData .trendDataItem p{padding-left:1.04rem;line-height:.746667rem;font-size:.533333rem;color:#f72f2f}#auctionData #trendData .trendDataItem p.nodata{margin-top:.186667rem;height:.533333rem;line-height:.533333rem;font-size:.3733333rem}#auctionData #trendData .trendDataItem p em{font-size:.373333rem}#auctionTrend{margin-top:.266667rem;width:100%;height:7.546667rem;background-color:#fff;overflow:hidden}#auctionTrend #trendChartBox{position:relative;width:100%;height:6.186667rem;overflow:hidden}#auctionTrend #trendChartBox.chart{background:url(../img/goods/trend_bg.png) center center/100% 100% no-repeat}#auctionTrend #trendChartBox #xScale{display:none;position:absolute;left:0;bottom:.56rem;width:100%;height:.453333rem}#auctionTrend #trendChartBox.chart #xScale{display:block}#auctionTrend #trendChartBox #xScale em{position:absolute;display:inline-block;width:1.04rem;height:.453333rem;text-align:center;line-height:.453333rem;font-size:.32rem;color:#999;white-space:nowrap}#auctionTrend #trendChartBox #xScale em:nth-child(1){left:.626667rem}#auctionTrend #trendChartBox #xScale em:nth-child(2){left:2.226667rem}#auctionTrend #trendChartBox #xScale em:nth-child(3){left:3.826667rem}#auctionTrend #trendChartBox #xScale em:nth-child(4){left:5.426667rem}#auctionTrend #trendChartBox #xScale em:nth-child(5){left:7.026667rem}#auctionTrend #trendChartBox #xScale em:nth-child(6){left:8.626667rem}#auctionTrend #trendChartBox #yScale{position:absolute;left:.453333rem;top:0;width:.586667rem;height:100%}#auctionTrend #trendChartBox #yScale em{position:absolute;right:0;display:inline-block;height:.453333rem;text-align:center;line-height:.453333rem;font-size:.32rem;color:#999}#auctionTrend #trendChartBox #yScale em:nth-child(1){bottom:.973333rem}#auctionTrend #trendChartBox #yScale em:nth-child(2){bottom:1.8rem}#auctionTrend #trendChartBox #yScale em:nth-child(3){bottom:2.626667rem}#auctionTrend #trendChartBox #yScale em:nth-child(4){bottom:3.453333rem}#auctionTrend #trendChartBox #yScale em:nth-child(5){bottom:4.28rem}#auctionTrend #trendChartBox #yScale em:nth-child(6){bottom:5.106667rem}#auctionTrend #trendChartBox .mark{position:absolute;width:1.546667rem;height:.773333rem}#auctionTrend #trendChartBox .mark i{position:absolute;left:.653333rem;display:inline-block;background:#fff;border:.066667rem solid #f72f2f;width:.106667rem;height:.106667rem;border-radius:100%}#auctionTrend #trendChartBox .mark p{position:absolute;width:100%;height:.426667rem;text-align:center;line-height:.426667rem;font-size:.293333rem;color:#f72f2f;white-space:nowrap}#auctionTrend #trendChartBox #minValPoint i{top:0}#auctionTrend #trendChartBox #minValPoint p{bottom:0}#auctionTrend #trendChartBox #maxValPoint i{bottom:0}#auctionTrend #trendChartBox #maxValPoint p{top:0}#auctionHistory{margin-top:.266667rem;width:100%;min-height:3.973333rem;background-color:#fff;overflow:hidden}.trendTitle{position:relative;width:100%;height:1.333333rem;border-bottom:.026667rem solid #f5f5f5}.trendTitle h2{padding-left:1.28rem;height:1.333333rem;line-height:1.333333rem;font-size:.4rem;color:#666}.trendTitle i{position:absolute;left:.453333rem;top:.346667rem;display:inline-block;width:.64rem;height:.64rem;background-color:#999}#latestdeal .historydeal-item{height:2.613333rem}#latestdeal .historydeal-item img{top:.986667rem;width:1.173333rem;height:1.173333rem}#latestdeal .historydeal-item .auction-time{margin:.4rem auto .133333rem auto;height:.453333rem;line-height:.453333rem}#latestdeal .historydeal-item .auction-detail{height:.56rem;line-height:.56rem}#latestdeal .historydeal-item .save-ratio{height:100%}#latestdeal .historydeal-item .save-ratio span{margin-top:1.013333rem;display:block;width:100%;height:.746667rem;line-height:.746667rem;font-size:.533333rem;color:#333}#latestdeal .historydeal-item .save-ratio em{margin-top:-.133333rem;display:block;width:100%;height:.453333rem;line-height:.453333rem;font-size:.32rem;color:#666}</style><div class="content" id="content"><div id="auctionTrendBox"><div id="auctionGoods"><img id="goodsImg" src="http://jp.ruirun123.cn/info/c16fbdd64c624c13981b9b763618d708.png"><p id="goodsDesc"></p><p id="goodsPrice"><span>竞拍价<em>￥</em><em>199.00</em></span><del>市场价¥1458.00</del></p><p id="goodsState" class="hide">预约中</p></div><div id="auctionData"><div class="trendTitle"><i style="background:url(../img/goods/trend_data.png) 0 0/100% 100% no-repeat"></i><h2>历史成交数据</h2></div><div id="trendData"><div class="trendDataItem" id="avgPrice"><h2>平均成交价</h2><p></p></div><div class="trendDataItem" id="avgNum"><h2>平均成交次数</h2><p></p></div><div class="trendDataItem" id="priceIncrease"><h2>价格环比上月</h2><p></p></div><div class="trendDataItem" id="numIncrease"><h2>次数环比上月</h2><p></p></div></div></div><div id="auctionTrend"><div class="trendTitle"><i style="background:url(../img/goods/trend_line.png) 0 0/100% 100% no-repeat"></i><h2>成交走势</h2></div><div id="trendChartBox"><div id="xScale"><em>第1次</em><em>第10次</em><em>第20次</em><em>第30次</em><em>第40次</em><em>第50次</em></div><div id="yScale"><em></em><em></em><em></em><em></em><em></em><em></em></div><div id="minValPoint" class="mark"></div><div id="maxValPoint" class="mark"></div><svg id="trendChartSvg" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet" viewBox="0,0,750,464"><defs><linearGradient x1="86" y1="374" x2="86" y2="64" id="fillColor"><stop stop-color="rgba(253,174,174,0)" offset="0"/><stop stop-color="rgba(253,174,174,1)" offset="1"/></linearGradient></defs></svg><div class="nodata" style="display:none"><i></i><h2>暂无数据记录</h2></div></div></div><div id="auctionHistory"><div class="trendTitle"><i style="background:url(../img/goods/trend_history.png) 0 0/100% 100% no-repeat"></i><h2>往期成交</h2></div><div id="latestdeal"></div></div><div class="goAuctionBtn">立即竞拍</div></div></div><script>T.auctionTrend=function(){var o="",i=0,s=T.Util.getPara("COMMODITY_ID"),r={init:function(){r.initGoodsInfo(),r.getAuctionTrend(),r.getHistoryAuction(),r.bindEvent()},bindEvent:function(){$(".goAuctionBtn").off().Touch(function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/view/go.html#page=goodsDetail.html&id="+s+"&isNext=1")}),$(window).off().scroll(function(){$(this).scrollTop(),$(document).height(),$(this).height()}),$("#auctionTrendBox").off().dropload({scrollArea:window,loadUpFn:function(t){o=t,i=1,r.getAuctionTrend(),r.getHistoryAuction()},threshold:50})},timeFormat:function(t){return"string"==typeof t?new Date(t.replace(/-/g,"/")).format("yyyy-MM-dd hh:mm"):"number"==typeof t?new Date(t).format("yyyy-MM-dd hh:mm"):"--:--"},getSaveRatio:function(t){return t.BARGAIN_MONEY&&t.MARKET_PRICE?(100-t.BARGAIN_MONEY/t.MARKET_PRICE*100).toFixed(2):"0.00"},initGoodsInfo:function(){var t=[];t.push('<img id="goodsImg" src="'+T.Util.getPara("COMMODITY_LOGO")+'">'),t.push('<p id="goodsDesc">'+(T.Util.getPara("PRODUCT_NOTE")||T.Util.getPara("COMMODITY_TITLE"))+"</p>"),t.push('<p id="goodsPrice"><span>竞拍价<em>￥</em><em class="AUCTION_PRICE">'+T.Util.getPara("AUCTION_PRICE")+"</em></span><del>市场价¥"+T.Util.getPara("MARKET_PRICE")+"</del></p>"),t.push('<p id="goodsState" class="hide">预约中</p>'),$("#auctionGoods").html(t.join("")).attr("data-id",T.Util.getPara("COMMODITY_ID"));var e=[];e.push("auction/commodity/"+s),T.Util.mqtt(e)},getAuctionTrend:function(){T.Util.xmlHttpRequest({type:"get",errorType:1,reqUrl:"/commodity/services/template/GET_EXPECT_INFO.json?commodityId="+s,callback:function(t){var e=t.res_data[0];if(100!=e.expectStatus){var a=80==e.expectStatus?"预约中":90==e.expectStatus?"暂停预约":120==e.expectStatus?"暂停竞拍":"已成交";$("#goodsState").html(a),$("#goodsPrice").hide(),$("#goodsState").show()}else $(".AUCTION_PRICE").html(e.auctionPrice.toFixed(2)),$("#goodsPrice").show(),$("#goodsState").hide()},errorCallback:function(t){tip(t.msg||t.result_msg)}});var a=86,o=90,i=600,r=310,n=50,g=0,C=100,_=0,f=0,A="M 686 374 L 86 374";function E(t,e){return[a+t*i/n,464-(o+(e-g)*r/(C-g))]}T.Util.xmlHttpRequest({type:"get",errorType:"1",reqUrl:"/commodity/services/product/favorite/stat.json?commodityId="+s,callback:function(t){var e=t.res_data.value.COMMODITY_INFO||{};$("#goodsDesc").html(e.COMMODITY_TITLE||e.COMMODITY_NAME),$("#goodsPrice del").html("市场价¥"+Number(e.MARKET_PRICE).toFixed(2));var a=t.res_data.value.MONTH_LIST;if(0<a.length)if((new Date).getMonth()+1==parseInt(a[0].MONTH_EXPECT.slice(-2))){var o=a[0]?a[0].AVG_PRICE:0,i=a[1]?a[1].AVG_PRICE:0,r=i?(o-i)/i:0,n=a[0]?a[0].AVG_NUM:0,s=a[1]?a[1].AVG_NUM:0,l=s?(n-s)/s:0;$("#avgPrice p").html("<em>￥</em>"+Number(a[0].AVG_PRICE).toFixed(2)),$("#avgNum p").html(parseInt(a[0].AVG_NUM)+"<em>次/天</em>"),1<a.length?($("#priceIncrease p").html("<em>"+(0<=r?"上升":"下降")+"</em>"+Math.abs(r).toFixed(2)+"<em>%</em>"),$("#numIncrease p").html("<em>"+(0<=l?"上升":"下降")+"</em>"+Math.abs(l).toFixed(2)+"<em>%</em>")):($("#priceIncrease p").addClass("nodata").text("暂无数据"),$("#numIncrease p").addClass("nodata").text("暂无数据"))}else $(".trendDataItem p").addClass("nodata").text("暂无数据");else $(".trendDataItem p").addClass("nodata").text("暂无数据");var d=t.res_data.value.EXPORT_LIST;if(d.length){$("#trendChartBox").addClass("chart");for(var c=0,m=d[0].AUCTION_PRICE,u=0;u<d.length;u++)d[u].AUCTION_PRICE>=c&&(f=u),d[u].AUCTION_PRICE<m&&(_=u),c=d[u].AUCTION_PRICE<c?c:d[u].AUCTION_PRICE,m=d[u].AUCTION_PRICE>m?m:d[u].AUCTION_PRICE;g=10*Math.floor(Math.floor(m-.1*(c-m))/10),C=10*Math.ceil(Math.ceil(c+.1*(c-m))/10),m==c&&(C+=5,g-=5),g=g<0?0:g;for(u=0;u<6;u++)$("#auctionTrend #trendChartBox #yScale em").eq(u).text(g+u*(C-g)/5);var h=E(_,d[_].AUCTION_PRICE),I=E(f,d[f].AUCTION_PRICE);$("#minValPoint").attr("style","left:"+(h[0]-58)/75+"rem;top:"+(h[1]-9)/75+"rem").html("<i></i><p>最低"+Number(m).toFixed(2)+"</p>"),$("#maxValPoint").attr("style","left:"+(I[0]-58)/75+"rem;top:"+(I[1]-49)/75+"rem").html("<i></i><p>最高"+Number(c).toFixed(2)+"</p>");var p=0;clearInterval(Global.drawCurvTimer),Global.drawCurvTimer=setInterval(function(){$("#trendChartSvg").find("path").remove(),$("#trendChartSvg").append(function(t,e){var a=E(t,e),o=a[0],i=a[1];A=A.replace(/M\s.*\s374\sL\s86\s374/,"M "+o+" 374 L 86 374"),A+=" "+o+" "+i;var r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",A),r.setAttribute("fill","url(#fillColor)"),r.setAttribute("stroke","#f72f2f"),r.setAttribute("stroke-width","2"),r}(p,d[p].AUCTION_PRICE)),(p+=1)>=d.length&&clearInterval(Global.drawCurvTimer)},10)}else $(".nodata").show().siblings().hide()},errorCallback:function(t){tip(t.msg||t.result_msg)}})},getHistoryAuction:function(a){!1,a||(i=0),T.Util.xmlHttpRequest({type:"get",errorType:1,reqUrl:"/commodity/services/order/pastDone.json?commodityId="+s+"&page="+i+"&limit=10",callback:function(t){!0;var e=t.res_data.value.INFO;"2"==t.res_data.value.ISEND?(!0,i++):!1,r.showHistoryAuction(e,a)},errorCallback:function(t){!0,""!=o&&(o.resetload(),o.unlock(),o.noData(!1),o="")}})},showHistoryAuction:function(t,e){var a=[];$.each(t,function(t,e){a.push('<div class="historydeal-item"><img class="userphoto lozad" src="../img/goods/lazy_load.png" data-src="'+e.USER_PIC+'">'),a.push('<h2 class="auction-time">'+r.timeFormat(e.BARGAIN_TIME)+'</h2><h2 class="auction-detail">成交人：<em>'+(e.NICK_NAME||e.USER_MOBILE)+"</em></h2>"),a.push('<h2 class="auction-detail">成交价：<em class="price">￥'+(e.BARGAIN_MONEY?e.BARGAIN_MONEY.toFixed(2):"0.00")+'</em></h2><h2 class="save-ratio'+(e.BARGAIN_MONEY>=e.MARKET_PRICE?" hide":"")+'"><span>'+r.getSaveRatio(e)+"%</span><em>节省</em></h2></div>")}),a.length?e?$("#latestdeal").append(a.join("")):$("#latestdeal").html(a.join("")):e||$("#latestdeal").html('<div class="nodata auction"><i></i><h2>暂无数据</h2></div>'),$(".detail-item").eq(2).css("min-height","inherit"),lozad().observe(),""!=o&&(o.resetload(),o.unlock(),o.noData(!1),o="")}};return{init:r.init}}(),$(document).ready(function(){T.auctionTrend.init()})</script>