!function(e){"use strict";var n=window,d=document,i=!1,l=e(n),a=e(d),r=parseFloat(e("html").css("font-size"));e.fn.dropload=function(o){return new t(this,o)};var t=function(o,t){var n=this;n.$element=o,n.upInsertDOM=!1,n.loading=!1,n.isLockUp=!1,n.isLockDown=!1,n.isData=!0,n._scrollTop=0,n._threshold=0,n.init(t)};function p(o){o.touches||(o.touches=o.originalEvent.touches)}var c=!(t.prototype.init=function(o){var t,s=this;s.opts=e.extend(!0,{},{scrollArea:s.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-load"><span class="loading"></span></div>',domUpdate:'<div class="dropload-load"><span class="loading"></span></div>',domLoad:'<div class="dropload-load"><span class="loading"></span></div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>Refreshing</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},autoLoad:!0,distance:50,threshold:"",loadUpFn:"",loadDownFn:""},o),""!=s.opts.loadDownFn&&(s.$element.append('<div class="'+s.opts.domDown.domClass+'">'+s.opts.domDown.domRefresh+"</div>"),s.$domDown=e("."+s.opts.domDown.domClass)),s.$domDown&&""===s.opts.threshold?s._threshold=Math.floor(1*s.$domDown.height()/3):s._threshold=s.opts.threshold,s.opts.scrollArea==n?(s.$scrollArea=l,s._scrollContentHeight=a.height(),s._scrollWindowHeight=d.documentElement.clientHeight):(s.$scrollArea=s.opts.scrollArea,s._scrollContentHeight=s.$element[0].scrollHeight,s._scrollWindowHeight=s.$element.height()),""!=s.opts.loadDownFn&&(t=s).opts.autoLoad&&t._scrollContentHeight-t._threshold<=t._scrollWindowHeight&&h(t),l.on("resize",function(){s.opts.scrollArea==n?s._scrollWindowHeight=n.innerHeight:s._scrollWindowHeight=s.$element.height()}),s.$element.on("touchstart",function(o){var t,n;0<e(window).scrollTop()?i=!0:(i=!1,s.loading||(p(o),t=o,(n=s)._startY=t.touches[0].pageY,n.touchScrollTop=n.$scrollArea.scrollTop()))}),s.$element.on("touchmove",function(o){i||s.loading||(p(o),function(o,t){t._curY=o.touches[0].pageY,t._moveY=t._curY-t._startY,0<t._moveY?t.direction="down":t._moveY<0&&(t.direction="up");var n=Math.abs(t._moveY);""!=t.opts.loadUpFn&&t.touchScrollTop<=0&&"down"==t.direction&&!t.isLockUp&&(o.preventDefault(),"match-list"==t.$element.attr("id")||"myFollowContent"==t.$element.attr("id")?t.upInsertDOM||(e("#main").prepend('<div class="'+t.opts.domUp.domClass+'"></div>'),t.upInsertDOM=!0):t.upInsertDOM||(t.upInsertDOM=!0,t.$element.prepend('<div class="'+t.opts.domUp.domClass+'"></div>')),t.$domUp=e("."+t.opts.domUp.domClass),m(t.$domUp,0),n<=t.opts.distance?(t._offsetY=n,t.$domUp.html(t.opts.domUp.domRefresh)):n>t.opts.distance&&n<=2*t.opts.distance?(t._offsetY=t.opts.distance+.5*(n-t.opts.distance),t.$domUp.html(t.opts.domUp.domUpdate)):t._offsetY=t.opts.distance+.5*t.opts.distance+.2*(n-2*t.opts.distance),t._offsetY>=98/75*r&&t.$domUp.css({opacity:t._offsetY/1.5/(98/75*r)}),t.$domUp.css({height:t._offsetY}),console.log("---------me._curY"+t._curY+"头加内容:"+(1*e("#goodscontent").height()+1*e(".navbar").height())),!c&&0<e("#goodscontent").length&&0<e(".navbar").length&&t._curY>1*e("#goodscontent").height()+1*e(".navbar").height()&&(c=!0,setTimeout(function(){m(t.$domUp,300),n>t.opts.distance?(t.$domUp.css({height:t.$domUp.children().height()}),t.$domUp.html(t.opts.domUp.domLoad),t.loading=!0,t.opts.loadUpFn(t)):0<t.$domUp.length&&t.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){t.upInsertDOM=!1,e(this).remove()}),t._moveY=0,t.$domUp.css({height:"1.17rem"}),c=!1},800)))}(o,s))}),s.$element.on("touchend",function(){var o,t;i||(s.loading||(o=s,t=Math.abs(o._moveY),""!=o.opts.loadUpFn&&o.touchScrollTop<=0&&"down"==o.direction&&!o.isLockUp&&(m(o.$domUp,300),t>o.opts.distance?(o.$domUp.css({height:o.$domUp.children().height()}),o.$domUp.html(o.opts.domUp.domLoad),o.loading=!0,o.opts.loadUpFn(o)):0<o.$domUp.length&&o.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){o.upInsertDOM=!1,e(this).remove()}),o._moveY=0,o.$domUp.css({height:"1.17rem"}))))}),""!=s.opts.loadDownFn&&s.$scrollArea.on("scroll",function(){s._scrollTop=s.$scrollArea.scrollTop(),""!=s.opts.loadDownFn&&!s.loading&&!s.isLockDown&&s._scrollContentHeight-s._threshold<=s._scrollWindowHeight+s._scrollTop&&h(s)})});function h(o){o.direction="up",o.$domDown.html(o.opts.domDown.domLoad),o.loading=!0,o.opts.loadDownFn(o)}function m(o,t){o.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}t.prototype.lock=function(o){var t=this;void 0===o?"up"==t.direction?t.isLockDown=!0:"down"==t.direction?t.isLockUp=!0:(t.isLockUp=!0,t.isLockDown=!0):"up"==o?t.isLockUp=!0:"down"==o&&(t.isLockDown=!0,t.direction="up")},t.prototype.unlock=function(){var o=this;o.isLockUp=!1,o.isLockDown=!1,o.direction="up"},t.prototype.noData=function(o){void 0===o||1==o?this.isData=!1:0==o&&(this.isData=!0)},t.prototype.resetload=function(){var t=this;"down"==t.direction&&t.upInsertDOM&&0<t.$domUp.length?t.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){var o;t.loading=!1,t.upInsertDOM=!1,e(this).remove(),(o=t).opts.scrollArea==n?o._scrollContentHeight=a.height():o._scrollContentHeight=o.$element[0].scrollHeight}):"up"==t.direction&&t.$domDown&&0<t.$domDown.length&&t.$domDown.css({height:"0"}).remove()}}(window.Zepto||window.jQuery);